# Тема ВКР: Исследование методов построения цифровых моделей объектов при выполнении операций мониторинга с использованием робо-животных.

## Аннотация:

В данной статье рассмотрено применение лидарного трехмерного SLAM на шагающем квадрупед роботе в симуляции Gazebo для построения трехмерной модели окружающего мира. Рассмотрены два метода трехмерного SLAM leo-sam и hdl-graph. Используя выбранные критерии, наиболее подходящие для оценки трехмерных карт, были сравнены эти два метода и была произведена оценка применения их на шагающем роботе. 
TODO: можно добавить про колебания если я их сделаю


## Введение

В современном технологичном мире все чаще начинают использовать трехмерные модели мира для оценки обстановки, мониторинга каких-либо явлений или для автономного управления самим роботом, который эту карту строит. Трехмерная карта для мониторинга используется в производственной, строительной или сельскохозяйственной деятельности (TODO: тут ссылка на источник должна быть).

Автономные роботы, которым для навигации необходима трехмерная карта, используются для опасных и трудоемких работ. Трехмерная карта для таких роботов нужна для построения наиболее точной траектории, например при управлении шагающим роботом или гусеничной техники необходимо оценивать каждое препятствие на возможность преодоления его. При использовании двумерного с SLAM любое препятствие выше определенной точки, например лестница, будет считаться непроходимым, в то время как шагающий робот может его преодолеть. 

В отличии от двумерного, алгоритмы трехмерного SLAM требуют большей точности датчиков, большей вычислительной мощности, а также имеют меньшую устойчивость к колебаниям и вибрациям робота и датчика при работе. При передвижении шагающего робота возникают резкие движения, колебания и вибрации, которые могут повлиять на корректное построение трехмерной карты. 

Кроме того, в сравнении с колесными платформами, у шагающих или гусечних роботов есть проблема с одометрией (ссылка). В случае с шагающим роботом, некоторые проекты таких роботов предоставляют одометрию, пocчитaнную из прямой кинематики ног, но по личному опыту точность этих данных бывает недостаточной, а некоторые разработки вообще не предоставляют одометрию. Рассмотренные в данной работе методы SLAM могут работать без внешней одометрии, для собственного расчета одометрии им необходимо только данные IMU (расшифорка) и данные с лидара.  

В данной работе рассматриваются два алгоритма трехмерного лидарного SLAM - HDL Graph SLAM (ссылка) и LIO-SAM. Будут рассмотрены их принцип работы, проведены испытания этих методов в симуляции, выбраны критерии оценки и на основе этих критериев произведена оценка работы алгоритмов.


## Алгоритмы SLAM

<!-- ПРо то что мы используем лидарный слэм,  в целом что в этой главе рассмотрены алгоритмы такой то такой то. почему мы их выбрали
какие алгоримты внутри себя они используют, какие датчики могут, какие датчики я буду использовать -->



### LIO-SAM
<!-- Опреление, особенности изучить: 
  it assumes a nonlinear motion model
  uses the idea of keyframes and sliding windows from visual SLAM systems
  The IMU data is critical for this system to work properly.
  интеграция с ROS -->

LIO-SAM - метод лидарного SLAM основанный на расчете одометрии за счет сглаживания и построения карты. Он основан на самом популярном методе трехмерного лидарного SLAM - LOAM (Lidar Odometry and Mapping). Ключевой идеей является разделение сложной задачи одновременной локализации и построения карты, которая направлена на одновременную оптимизацию большого количества переменных. Один алгоритм выполняет одометрию с высокой частотой, но с низкой точностью для оценки скорости лидара. Другой алгоритм работает на частоте на порядок ниже для точного сопоставления и регистрации облака точек. Комбинация двух алгоритмов позволяет методу строить точную трехмерную карту в режиме реального времени \cite{loam}. 

На рисунке \ref{pic:loam_algo} изображена блок схема алгоритма c указанием частоты работы отдельных частей алгоритма. Одометрия лидара берет облако точек и вычисляет движение лидара между двумя положениями. Расчетное движение используется для исправления искажения в облаке точек. Алгоритм работает на частоте около 10 Гц. Выходные данные дополнительно обрабатываются построением карты, которое сопоставляет и регистрирует неискаженное облако на карте с частотой 1 Гц. Наконец, преобразования местоположения, опубликованные двумя алгоритмами, объединяются для создания выходных данных преобразования с частотой около 10 Гц относительно положения лидара по отношению к карте.

\addimghere{loam_algo}{0.99}{Блок-схема алгоритма расчета одометри и построения карты}{pic:loam_algo}

В отличие от LOAM, LIO-SAM предоставляет возможность использовать дополнительные датчики, такие как 9-осевой инерционный датчик IMU или GPS модуль. Это позволяет исправить главную проблему родительского метода - накопление ошибки при работе алгоритма (ссылка). 

Кроме того, переработан алгоритм оптимизации положения, вместо сравнивания каждого нового скана с глобальной картой, используются предшествующие данные скнирования. Сопоставление сканирования в локальном масштабе, а не в глобальном масштабе, значительно улучшает производительность системы в реальном времени. Для решения проблемы с замыканимем петель, используется выборочное введение ключевых кадров и эффективный подход скользящего окна, который регистрирует новый ключевой кадр в наборе предыдущих. На рисунке \ref{pic:lio_sam_algo} изображена блок-схема работы улучшенного алгоритма. В расчет положения включаются данные всех видов датчиков. 

\addimghere{lio_sam_algo}{0.5}{Блок-схема алгоритма LIO-SAM}{pic:lio_sam_algo}

### HDL-Graph
HDL Graph SLAM — это пакет ROS с открытым исходным кодом для трехмерного SLAM в реальном времени с использованием 3D лидара. Он базируется на 3D SLAM на основе графов  с оценкой одометрии и обнаружением петель. Он также поддерживает несколько способов уточнений карты, таких как GPS и обнаружение плоскости пола в облаке точек. Основное отличие от Cartographe состоит в том, что данная система SLAM не использует данные IMU для оценки одометрии. Одометрия рассчитывается непосредственно из данных лидара путем вычисления преобразования, необходимого для перекрытия последних сканирований.

Входное облако точек сначала подвергается субдискретизации, для ускорения последующих вычислений. После этого одновременно выполняется оценка положения датчика, итеративно применяя сопоставление сканирования между последовательными кадрами, то есть производится оценка одометрии, и  производится определение плоскости пола с помощью RANSAC (Random Sample Consensus). Чтобы компенсировать накопленную ошибку сопоставления сканирования, выполняется обнаружение петли и оптимизируется граф положения, который учитывает различные ограничения \cite{hdl_graph_slam}.

SLAM на основе графов — один из самых успешных подходов к SLAM .В этом подходе задача SLAM решается путем построения и оптимизации графа, узлы которого представляют параметры, подлежащие оптимизации, такие как местоположение робота и положения ориентиров, а ребра представляют ограничения, такие как относительные положения между положениями робота и ориентирами. Граф оптимизирован таким образом, чтобы ошибки между параметрами и ограничениями были сведены к минимуму. 

В системе сначала оценивается траектория робота, итеративно сравнивая сканирования между последовательными кадрами, используя преобразование нормального распределения (Normal Distributions Transform, NDT). Для 3D-лидаров NDT показывает лучшую производительность, чем другие алгоритмы сопоставления сканирования с точки зрения как надежности, так и скорости обработки \cite{graph}. На рисунке \ref{pic:graph} изображена упрощенная структура графа HDL Graph SLAM. 

\addimghere{graph}{0.99}{Структура графа}{pic:graph}

Первым шагом алгоритма обнаружения петель является обнаружение кандидатов на петлю на основе расстояния и длины траектории между узлами. Затем для проверки кандидатов цикла между узлами каждого кандидата применяется алгоритм сопоставления сканирования NDT. Если оценка пригодности ниже порогового значения, происходит добавление петли в граф, в виде ребра между узлами. 


<!-- ### в конце можно табличку и смол вывод по разделу -->
## Реализация

Ввиду того, что доступа к реальному шагающему роботу нет, принято решение проводить эксперименты в виртуальной среде Gazebo. Симуляция физики в Gazebo и скорость его работы дает возможность произвести оценку работы методов SLAM в первом приближении. В данном симуляторe есть возможность самостоятельно создавать сцены в которых будут тестироваться алгоритмы, кроме того в открытом доступе есть плагины которые симулируют популярные сенсоры с их гибкой настройкой, например настраиваемая степень гауссовского шума, который присутствует в любом реальном датчике.
Вся программная база строится на фрейворке ROS (Robotic Operating System), методы LIO-SAM и HDL Graph уже имеют свою реализацию интегрированную в этот фреймворк. 

В качестве робота был выбран фреймворк CHAMP, в составе которого есть 3D модель квадрупед робота, его urdf-описание и виртуальные контроллеры необходимые для работы в ROS и Gazebo. Дополнительно робот оснащен 3D лидаром  Velodyne VLP-16 и 9-осевым IMU плагином. В качестве цифрового двойника реального сценария использования данного робота, разработана сцена строительной площадки (рис. \ref{pic:scene}).

### Тестовые сценарии

Были разработаны 3 сценария с различной стпенью слжности, по которым премещается робот одинаково для обоих методов SLAM. Траектория движения при работе разных алгоритмов будет максимально схожей, что позволит наиболее точно сравнить их. 

 * Первый сценарий - робот движется по прямой. Сценарий покажет на сколько смещается сгенерированная траектория. 
 * Второй сценарий - проход вокруг бочек с возвращением в начальную точку. Данный сценарий должен вызвать работу алгоритма определения замкнутой петли.
 * Третий сценарий - обход все территории строительной площадки. Построние полной карты рабочей области, с объектами разной высоты и дальности от робота.

Для генерации этих траекотрий были написаны программы для управления роботом CHAMP. На рисунке (ссылка на картинку) изображены примерные траектории всех сценриев. 

картинка с сценариями

### Настройка SLAM и датчиков


Как говорилось ранеe, используемые методы SLAM уже имеют реализацию в ROS \cite{hdlgraph_github,liosam_github}. Для корректной работы LIO-SAM с фрейворком CHAMP, плагинами лидара и IMU необходимо изменить параметры в конфигурационном файле. Для работы HDL-Graph аналогичные параметры указываются в стартовом "roslaunch" файле. Для обоих методов были отключены функционал отвечающий за GPS. 

Плагин лидара Velodyne VLP-16 и стандартный инерционный датчик IMU был добавлен в urdf описание CHAMP с параметрами, соответствующими их реальным аналогам, в том числе был добавлен гауссовский шум. Для IMU был добавлен реалистичный дрейф значений по всем осям. Частота обновления значений для лидара равна 10 Гц, для инерционного датчика выставлена 50 Гц. 



## Оценка результатов
### Критерии оценки








### Резултаты

## Заключение

